<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Czech Flashcard App - Spaced Repetition</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🇨🇿</text></svg>">
    <meta name="description" content="Learn Czech vocabulary with spaced repetition and cloud sync!">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#3B82F6">
</head>
<body>
    <div id="root"></div

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { createClient } = supabase;

        // Supabase credentials
        const supabaseUrl = 'https://luydswutvsttbpvruylm.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1eWRzd3V0dnN0dGJwdnJ1eWxtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg2MDQzMjgsImV4cCI6MjA2NDE4MDMyOH0.RvrljR2_T4oDCWkyrvCxPSRc7aiUYflzQ8sX_cU-urI';
        const supabaseClient = createClient(supabaseUrl, supabaseKey);

        const CzechFlashcardApp = () => {
            // All state variables
            const [currentScreen, setCurrentScreen] = useState('login');
            const [currentCardIndex, setCurrentCardIndex] = useState(0);
            const [showAnswer, setShowAnswer] = useState(false);
            const [studyCards, setStudyCards] = useState([]);
            const [sessionStats, setSessionStats] = useState({
                cardsStudied: 0,
                newCards: 0,
                reviewCards: 0,
                againCards: 0,
                easyCards: 0,
                normalCards: 0,
                hardCards: 0
            });
            const [allVocabulary, setAllVocabulary] = useState([]);
            const [manualCzech, setManualCzech] = useState('');
            const [manualEnglish, setManualEnglish] = useState('');
            const [userId, setUserId] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [isSyncing, setIsSyncing] = useState(false);
            const [lastSyncTime, setLastSyncTime] = useState(null);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isRegistering, setIsRegistering] = useState(false);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [connectionError, setConnectionError] = useState(null);
            const [csvCards, setCsvCards] = useState([]);
            const [csvValidationResults, setCsvValidationResults] = useState([]);
            const [isProcessingCsv, setIsProcessingCsv] = useState(false);
            const csvInputRef = useRef(null);
            const [typingGameCards, setTypingGameCards] = useState([]);
            const [typingCurrentIndex, setTypingCurrentIndex] = useState(0);
            const [userInput, setUserInput] = useState('');
            const [showFeedback, setShowFeedback] = useState(false);
            const [isCorrect, setIsCorrect] = useState(false);
            const [typingRecallMode, setTypingRecallMode] = useState('czech-to-english'); // or 'english-to-czech'


            // Spaced Repetition Algorithm - Based on Anki's SM-2 algorithm
            const calculateNextReview = (card, grade) => {
    const now = new Date();
    
    let interval = card.interval || 1;
    let easeFactor = card.easeFactor || 2.5;
    let repetitions = card.repetitions || 0;

    if (grade < 3) {
        // If failed (grade 0-2), reset repetitions
        repetitions = 0;
        interval = 1;
    } else {
        repetitions += 1;
        if (repetitions === 1) {
            interval = 1;
        } else if (repetitions === 2) {
            interval = 6;
        } else {
            interval = Math.round(interval * easeFactor);
        }

        // Adjust easeFactor based on grade
        easeFactor += (0.1 - (5 - grade) * (0.08 + (5 - grade) * 0.02));
        if (easeFactor < 1.3) easeFactor = 1.3;
    }

    const nextReviewDate = new Date(now);
    nextReviewDate.setDate(now.getDate() + interval);

    return {
        nextReviewDate: nextReviewDate.toISOString(),
        interval,
        easeFactor: Math.round(easeFactor * 100) / 100,
        repetitions,
        lastReviewed: now.toISOString()
    };
};


            // Get cards due for review
            const getCardsForStudy = () => {
                const now = new Date();
                const dueCards = allVocabulary.filter(card => {
                    if (!card.nextReviewDate) return true; // New cards
                    return new Date(card.nextReviewDate) <= now;
                });
                
                // Sort by priority: overdue cards first, then new cards
                return dueCards.sort((a, b) => {
                    const aDate = a.nextReviewDate ? new Date(a.nextReviewDate) : new Date(0);
                    const bDate = b.nextReviewDate ? new Date(b.nextReviewDate) : new Date(0);
                    return aDate - bDate;
                });
            };

            // Update card after review
            const updateCardProgress = (cardIndex, difficulty) => {
                const card = studyCards[cardIndex];
                const originalIndex = allVocabulary.findIndex(c => 
                    c.czech === card.czech && c.english === card.english
                );
                
                if (originalIndex === -1) return;
                
                const updatedCard = {
                    ...allVocabulary[originalIndex],
                    ...calculateNextReview(allVocabulary[originalIndex], difficulty)
                };
                
                const updatedVocabulary = [...allVocabulary];
                updatedVocabulary[originalIndex] = updatedCard;
                setAllVocabulary(updatedVocabulary);
                
                // Update session stats
                setSessionStats(prev => ({
                    ...prev,
                    cardsStudied: prev.cardsStudied + 1,
                    [difficulty + 'Cards']: prev[difficulty + 'Cards'] + 1,
                    newCards: !card.lastReviewed ? prev.newCards + 1 : prev.newCards,
                    reviewCards: card.lastReviewed ? prev.reviewCards + 1 : prev.reviewCards
                }));
                
                // Auto-save updated vocabulary
                setTimeout(() => {
                    saveToDatabase(updatedVocabulary);
                }, 500);
            };

            // User management functions with Supabase
            const registerUser = async (email, password, username) => {
                try {
                    setIsLoading(true);
                    setConnectionError(null);
                    
                    const { data, error } = await supabaseClient.auth.signUp({
                        email: email,
                        password: password,
                        options: {
                            data: {
                                username: username
                            }
                        }
                    });

                    if (error) {
                        console.error('Registration error:', error);
                        setConnectionError(`Registration failed: ${error.message}`);
                        return false;
                    }

                    alert('Registration successful! Please check your email to verify your account, then sign in.');
                    return true;
                } catch (error) {
                    console.error('Registration error:', error);
                    setConnectionError('Registration failed. Please check your internet connection and try again.');
                    return false;
                } finally {
                    setIsLoading(false);
                }
            };

            const loginUser = async (email, password) => {
                try {
                    setIsLoading(true);
                    setConnectionError(null);
                    
                    const { data, error } = await supabaseClient.auth.signInWithPassword({
                        email: email,
                        password: password
                    });

                    if (error) {
                        console.error('Login error:', error);
                        setConnectionError(`Login failed: ${error.message}`);
                        return false;
                    }

                    return data.user;
                } catch (error) {
                    console.error('Login error:', error);
                    setConnectionError('Login failed. Please check your internet connection and try again.');
                    return false;
                } finally {
                    setIsLoading(false);
                }
            };

            const logoutUser = async () => {
                try {
                    await supabaseClient.auth.signOut();
                    setIsLoggedIn(false);
                    setCurrentUser(null);
                    setUserId('');
                    setAllVocabulary([]);
                    setEmail('');
                    setPassword('');
                    setCurrentScreen('login');
                    setLastSyncTime(null);
                } catch (error) {
                    console.error('Logout error:', error);
                }
            };

            const loadUserVocabulary = async (user) => {
                try {
                    setIsLoading(true);
                    console.log('Loading vocabulary for user:', user.id);
                    
                    const { data, error } = await supabaseClient
                        .from('user_vocabulary')
                        .select('vocabulary, updated_at')
                        .eq('user_id', user.id)
                        .single();

                    if (error) {
                        console.error('Error loading vocabulary:', error);
                        
                        if (error.code === 'PGRST116') { 
                            console.log('No vocabulary found, creating initial record');
                            await saveToDatabase([]);
                            setAllVocabulary([]);
                        } else if (error.code === '42501') {
                            alert('Permission denied. Please check your account access.');
                            setAllVocabulary([]);
                        } else {
                            console.error('Database error:', error.message);
                            setAllVocabulary([]);
                        }
                        return;
                    }

                    if (data && data.vocabulary) {
                        console.log('Loaded vocabulary:', data.vocabulary.length, 'cards');
                        setAllVocabulary(data.vocabulary || []);
                        setLastSyncTime(new Date(data.updated_at));
                    } else {
                        setAllVocabulary([]);
                    }
                } catch (error) {
                    console.error('Error loading vocabulary:', error);
                    setAllVocabulary([]);
                } finally {
                    setIsLoading(false);
                }
            };

            const saveToDatabase = async (vocabulary) => {
                if (!currentUser || isSyncing) return;
                
                try {
                    setIsSyncing(true);
                    console.log('Saving vocabulary for user:', currentUser.id, 'Cards:', vocabulary.length);
                    
                    const { data, error } = await supabaseClient
                        .from('user_vocabulary')
                        .upsert({
                            user_id: currentUser.id,
                            vocabulary: vocabulary,
                            updated_at: new Date().toISOString()
                        }, {
                            onConflict: 'user_id'
                        });

                    if (error) {
                        console.error('Error saving vocabulary:', error);
                        
                        if (error.code === '42501') {
                            alert('Permission denied. Please check your account permissions.');
                        } else if (error.code === '23505') {
                            console.log('Trying update instead of upsert...');
                            const { error: updateError } = await supabaseClient
                                .from('user_vocabulary')
                                .update({
                                    vocabulary: vocabulary,
                                    updated_at: new Date().toISOString()
                                })
                                .eq('user_id', currentUser.id);
                                
                            if (updateError) {
                                console.error('Update also failed:', updateError);
                                alert('Failed to save vocabulary. Please try again.');
                            } else {
                                setLastSyncTime(new Date());
                                console.log('Successfully updated vocabulary');
                            }
                        } else {
                            alert(`Failed to sync vocabulary: ${error.message}`);
                        }
                    } else {
                        setLastSyncTime(new Date());
                        console.log('Successfully synced vocabulary');
                    }
                } catch (error) {
                    console.error('Error saving vocabulary:', error);
                    alert('Sync failed due to network error. Please check your connection.');
                } finally {
                    setTimeout(() => {
                        setIsSyncing(false);
                    }, 1000);
                }
            };

            const handleLogin = async (e) => {
                e.preventDefault();
                if (!email.trim() || !password.trim()) {
                    setConnectionError('Please enter both email and password');
                    return;
                }

                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email.trim())) {
                    setConnectionError('Please enter a valid email address');
                    return;
                }

                if (isRegistering) {
                    const usernameForRegistration = email.split('@')[0];
                    
                    const success = await registerUser(email.trim(), password, usernameForRegistration);
                    if (success) {
                        setIsRegistering(false);
                        setPassword('');
                    }
                } else {
                    const user = await loginUser(email.trim(), password);
                    if (user) {
                        setCurrentUser(user);
                        setUserId(user.id);
                        setIsLoggedIn(true);
                        setCurrentScreen('home');
                        await loadUserVocabulary(user);
                    }
                }
            };

            const handleLogout = () => {
                logoutUser();
            };

            // Study functions
            const startStudySession = () => {
                const dueCards = getCardsForStudy();
                if (dueCards.length === 0) {
                    alert('No cards are due for review right now! Come back later or add more cards.');
                    return;
                }
                
                setStudyCards(dueCards);
                setCurrentCardIndex(0);
                setShowAnswer(false);
                setSessionStats({
                    cardsStudied: 0,
                    newCards: 0,
                    reviewCards: 0,
                    againCards: 0,
                    easyCards: 0,
                    normalCards: 0,
                    hardCards: 0
                });
                setCurrentScreen('study');
            };

            const handleAnswer = (grade) => {
    updateCardProgress(currentCardIndex, grade);
    
    setTimeout(() => {
        const updatedStudyCards = studyCards.filter((_, index) => index !== currentCardIndex);
        setStudyCards(updatedStudyCards);
        
        if (updatedStudyCards.length === 0) {
            setCurrentScreen('results');
        } else {
            if (currentCardIndex >= updatedStudyCards.length) {
                setCurrentCardIndex(0);
            }
            setShowAnswer(false);
        }
    }, 500);
};

            const startTypingRecallGame = (mode) => {
    const shuffled = [...allVocabulary].sort(() => Math.random() - 0.5); // Shuffle cards
    setTypingGameCards(shuffled);
    setTypingCurrentIndex(0);
    setUserInput('');
    setShowFeedback(false);
    setTypingRecallMode(mode);
    setCurrentScreen('typingRecall');
};

            const addManualCard = (czech, english) => {
                if (!czech.trim() || !english.trim()) {
                    alert('Please fill in both Czech and English fields');
                    return;
                }
                
                const newCard = {
                    czech: czech.trim(),
                    english: english.trim(),
                    consecutiveCorrect: 0,
                    easeFactor: 2.5,
                    interval: 1,
                    nextReviewDate: new Date().toISOString(),
                    lastReviewed: null
                };
                
                const updatedVocabulary = [...allVocabulary, newCard];
                setAllVocabulary(updatedVocabulary);
                setManualCzech('');
                setManualEnglish('');
                alert('Card added successfully!');
                
                setTimeout(() => {
                    saveToDatabase(updatedVocabulary);
                }, 500);
            };

            const handleManualSubmit = (e) => {
                e.preventDefault();
                addManualCard(manualCzech, manualEnglish);
            };

            // CSV processing functions
            const handleCsvUpload = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                if (!file.name.toLowerCase().endsWith('.csv')) {
                    alert('Please upload a CSV file');
                    return;
                }

                setIsProcessingCsv(true);
                setCurrentScreen('csvProcessing');

                try {
                    const text = await file.text();
                    parseCsvText(text);
                } catch (error) {
                    console.error('Error reading CSV file:', error);
                    alert('Error reading CSV file. Please try again.');
                    setCurrentScreen('home');
                }

                setIsProcessingCsv(false);
            };

            const parseCsvText = (csvText) => {
                console.log('Parsing CSV text:', csvText);
                
                const lines = csvText.split('\n').filter(line => line.trim());
                const parsed = [];
                const validationRes = [];

                lines.forEach((line, index) => {
                    if (index === 0 && (line.toLowerCase().includes('czech') || line.toLowerCase().includes('english'))) {
                        return;
                    }

                    let parts = [];
                    if (line.includes(',')) {
                        parts = line.split(',');
                    } else if (line.includes(';')) {
                        parts = line.split(';');
                    } else if (line.includes('\t')) {
                        parts = line.split('\t');
                    }

                    if (parts.length >= 2 && parsed.length < 300) {
                        let czech = parts[0].trim().replace(/^["'](.*)["']$/, '$1');
                        let english = parts[1].trim().replace(/^["'](.*)["']$/, '$1');

                        if (czech.length >= 2 && english.length >= 2) {
                            const validation = validateCardPair(czech, english);
                            parsed.push({ czech, english, id: index });
                            validationRes.push(validation);
                            console.log(`Found CSV pair: "${czech}" - "${english}"`);
                        }
                    }
                });

                console.log(`Parsed ${parsed.length} CSV pairs`);
                setCsvCards(parsed);
                setCsvValidationResults(validationRes);
                
                if (parsed.length === 0) {
                    alert(`No vocabulary pairs found in CSV. Make sure your CSV has this format:\n\nczech_word,english_word\ndobrý den,good day\nděkuji,thank you`);
                }
            };

            const addCsvCardsToVocabulary = () => {
                const validCards = csvCards.filter((card, index) => {
                    const validation = csvValidationResults[index];
                    return !validation || validation.isValid || card.manuallyApproved;
                }).map(card => ({
                    ...card,
                    consecutiveCorrect: 0,
                    easeFactor: 2.5,
                    interval: 1,
                    nextReviewDate: new Date().toISOString(),
                    lastReviewed: null
                }));
                
                const updatedVocabulary = [...allVocabulary, ...validCards];
                setAllVocabulary(updatedVocabulary);
                setCsvCards([]);
                setCsvValidationResults([]);
                setCurrentScreen('home');
                alert(`Added ${validCards.length} new cards from CSV to your vocabulary!`);
                
                setTimeout(() => {
                    saveToDatabase(updatedVocabulary);
                }, 500);
            };

            const approveCsvCard = (index) => {
                const updated = [...csvCards];
                updated[index].manuallyApproved = true;
                setCsvCards(updated);
            };

            const editCsvCard = (index, field, value) => {
                const updated = [...csvCards];
                updated[index][field] = value;
                setCsvCards(updated);
            };

            const removeCsvCard = (index) => {
                const updated = csvCards.filter((_, i) => i !== index);
                setCsvCards(updated);
            };

            const forceSync = async () => {
                if (!isSyncing) {
                    await saveToDatabase(allVocabulary);
                }
            };
            
            const validateCzechWord = (word) => {
                const cleanWord = word.toLowerCase().trim();
                const czechChars = ['č', 'š', 'ž', 'ř', 'ď', 'ť', 'ň', 'ů', 'á', 'é', 'í', 'ó', 'ú', 'ý'];
                const hasCzechChars = czechChars.some(char => cleanWord.includes(char));
                return hasCzechChars || cleanWord.length >= 3;
            };

            const validateEnglishWord = (word) => {
                const cleanWord = word.toLowerCase().trim();
                const englishPattern = /^[a-z\s\-'\.]+$/i;
                return englishPattern.test(cleanWord) && cleanWord.length >= 1;
            };

            const validateCardPair = (czech, english) => {
                const czechValid = validateCzechWord(czech);
                const englishValid = validateEnglishWord(english);
                
                return {
                    isValid: czechValid && englishValid,
                    czechValid,
                    englishValid,
                    issues: [
                        ...(!czechValid ? ['Czech word might be incorrect'] : []),
                        ...(!englishValid ? ['English word might be incorrect'] : [])
                    ]
                };
            };

            // Initialize app and check for existing session
            useEffect(() => {
                const checkSession = async () => {
                    try {
                        console.log('Starting session check...');
                        setIsLoading(true);
                        
                        const sessionPromise = supabaseClient.auth.getSession();
                        const timeoutPromise = new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Session check timeout')), 10000)
                        );
                        
                        const { data: { session }, error } = await Promise.race([sessionPromise, timeoutPromise]);
                        
                        if (error) {
                            console.error('Session check error:', error);
                            setCurrentScreen('login');
                            return;
                        }
                        
                        if (session?.user) {
                            console.log('Found existing session for user:', session.user.email);
                            setCurrentUser(session.user);
                            setUserId(session.user.id);
                            setEmail(session.user.email);
                            setIsLoggedIn(true);
                            setCurrentScreen('home');
                        } else {
                            console.log('No existing session found');
                            setCurrentScreen('login');
                        }
                    } catch (error) {
                        console.error('Session check failed:', error);
                        setCurrentScreen('login');
                        setConnectionError('Connection failed. Please check your internet connection.');
                    } finally {
                        setIsLoading(false);
                    }
                };

                const timer = setTimeout(checkSession, 500);

                const { data: { subscription } } = supabaseClient.auth.onAuthStateChange(
                    async (event, session) => {
                        console.log('Auth state change:', event, session?.user?.email);
                        
                        if (event === 'SIGNED_IN' && session?.user) {
                            setCurrentUser(session.user);
                            setUserId(session.user.id);
                            setEmail(session.user.email);
                            setIsLoggedIn(true);
                            setCurrentScreen('home');
                            setConnectionError(null);
                        } else if (event === 'SIGNED_OUT') {
                            setCurrentUser(null);
                            setUserId('');
                            setEmail('');
                            setIsLoggedIn(false);
                            setCurrentScreen('login');
                            setAllVocabulary([]);
                            setLastSyncTime(null);
                        } else if (event === 'TOKEN_REFRESHED') {
                            console.log('Token refreshed successfully');
                        }
                    }
                );

                return () => {
                    clearTimeout(timer);
                    subscription.unsubscribe();
                };
            }, []);

            useEffect(() => {
                if (allVocabulary.length > 0 && !isLoading && currentUser && isLoggedIn && !isSyncing) {
                    const timeoutId = setTimeout(() => {
                        saveToDatabase(allVocabulary);
                    }, 3000);

                    return () => clearTimeout(timeoutId);
                }
            }, [allVocabulary, currentUser?.id]);

            const currentCard = studyCards[currentCardIndex];

            // Helper function to get due cards count
            const getDueCardsCount = () => {
                const now = new Date();
                return allVocabulary.filter(card => {
                    if (!card.nextReviewDate) return true;
                    return new Date(card.nextReviewDate) <= now;
                }).length;
            };

            // Helper function to calculate next interval for display
            const getNextInterval = (card, grade) => {
    if (!card) return 1;
    
    const interval = card.interval || 1;
    const easeFactor = card.easeFactor || 2.5;
    const repetitions = card.repetitions || 0;

    if (grade < 3) {
        return 1; // Fail → reset
    } else {
        if (repetitions + 1 === 1) {
            return 1; // First success → 1 day
        } else if (repetitions + 1 === 2) {
            return 6; // Second success → 6 days
        } else {
            return Math.round(interval * easeFactor); // Further spaced
        }
    }
};

            // Login Screen
            if (!isLoggedIn) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 p-4 flex items-center justify-center">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                            <div className="text-center mb-8">
                                <div className="text-6xl mb-4">🇨🇿</div>
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">Czech Flashcards</h1>
                                <p className="text-gray-600">
                                    {isRegistering ? 'Create your account' : 'Sign in to your account'}
                                </p>
                            </div>

                            {connectionError && (
                                <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                                    <div className="text-red-800 text-sm">{connectionError}</div>
                                </div>
                            )}

                            <form onSubmit={handleLogin} className="space-y-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Email Address
                                    </label>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        placeholder="Enter your email address"
                                        className="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
                                        required
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Password
                                    </label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        placeholder="Enter your password"
                                        className="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
                                        required
                                        minLength="6"
                                    />
                                </div>

                                <button
                                    type="submit"
                                    disabled={isLoading}
                                    className="w-full bg-blue-600 text-white py-4 px-6 rounded-xl font-semibold text-lg hover:bg-blue-700 transition-colors disabled:opacity-50"
                                >
                                    {isLoading ? 'Processing...' : (isRegistering ? 'Create Account' : 'Sign In')}
                                </button>
                            </form>

                            <div className="mt-6 text-center">
                                <button
                                    onClick={() => {
                                        setIsRegistering(!isRegistering);
                                        setPassword('');
                                        setConnectionError(null);
                                    }}
                                    className="text-blue-600 hover:text-blue-700 underline"
                                >
                                    {isRegistering ? 'Already have an account? Sign in' : 'Need an account? Register'}
                                </button>
                            </div>

                            <div className="mt-8 p-4 bg-blue-50 rounded-lg">
                                <h3 className="font-semibold text-blue-800 mb-2">🌟 Features:</h3>
                                <ul className="text-sm text-blue-700 space-y-1">
                                    <li>• Spaced repetition algorithm (Anki-style)</li>
                                    <li>• Easy/Normal/Hard difficulty options</li>
                                    <li>• Cloud sync across devices</li>
                                    <li>• Add cards manually or from CSV</li>
                                </ul>
                            </div>

                            <div className="mt-6 text-center">
                                <div className="text-xs text-gray-500">
                                    🌐 Your account works on any device • 🔒 Secure authentication
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Loading Screen
            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 p-4 flex items-center justify-center">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 text-center max-w-md">
                            <div className="animate-spin rounded-full h-16 w-16 border-4 border-blue-500 border-t-transparent mx-auto mb-4"></div>
                            <h2 className="text-xl font-bold text-gray-800 mb-2">Connecting...</h2>
                            <p className="text-gray-600 mb-4">Checking your login status</p>
                            
                            <button
                                onClick={() => {
                                    setIsLoading(false);
                                    setCurrentScreen('login');
                                    setConnectionError('Connection timeout. Please try logging in manually.');
                                }}
                                className="text-blue-600 hover:text-blue-700 underline text-sm"
                            >
                                Skip to login
                            </button>
                            
                            <div className="mt-4 text-xs text-gray-500">
                                If this takes too long, click "Skip to login"
                            </div>
                        </div>
                    </div>
                );
            }

            // Home Screen
            if (currentScreen === 'home') {
                const dueCards = getDueCardsCount();
                const newCardsCount = allVocabulary.filter(card => !card.lastReviewed).length;
                const reviewCardsCount = allVocabulary.filter(card => card.lastReviewed && new Date(card.nextReviewDate) <= new Date()).length;
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 p-4">
                        <div className="max-w-md mx-auto">
                            <div className="bg-white rounded-2xl shadow-2xl p-8 text-center">
                                <div className="flex justify-between items-center mb-6">
                                    <div className="text-left">
                                        <div className="text-sm text-gray-500">Welcome back,</div>
                                        <div className="font-semibold text-gray-800">
                                            {currentUser?.user_metadata?.username || currentUser?.email?.split('@')[0]}
                                        </div>
                                    </div>
                                    <button
                                        onClick={handleLogout}
                                        className="text-sm text-red-600 hover:text-red-700 underline"
                                    >
                                        Logout
                                    </button>
                                </div>

                                <div className="text-6xl mb-6">🇨🇿</div>
                                <h1 className="text-3xl font-bold text-gray-800 mb-4">Czech Vocabulary</h1>
                                <p className="text-gray-600 mb-8">Spaced repetition learning system</p>
                                
                                <div className="grid grid-cols-2 gap-4 mb-6">
                                    <div className="bg-blue-50 p-4 rounded-xl">
                                        <div className="text-2xl font-bold text-blue-600">{allVocabulary.length}</div>
                                        <div className="text-sm text-gray-600">Total Cards</div>
                                    </div>
                                    <div className="bg-orange-50 p-4 rounded-xl">
                                        <div className="text-2xl font-bold text-orange-600">{dueCards}</div>
                                        <div className="text-sm text-gray-600">Due Today</div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-4 mb-6">
                                    <div className="bg-green-50 p-4 rounded-xl">
                                        <div className="text-xl font-bold text-green-600">{newCardsCount}</div>
                                        <div className="text-sm text-gray-600">New</div>
                                    </div>
                                    <div className="bg-purple-50 p-4 rounded-xl">
                                        <div className="text-xl font-bold text-purple-600">{reviewCardsCount}</div>
                                        <div className="text-sm text-gray-600">Review</div>
                                    </div>
                                </div>

                                {allVocabulary.length === 0 && !isSyncing && (
                                    <button
                                        onClick={() => loadUserVocabulary(currentUser)}
                                        className="w-full bg-blue-600 text-white py-3 px-6 rounded-xl font-semibold mb-4 hover:bg-blue-700 transition-colors"
                                    >
                                        Load My Vocabulary
                                    </button>
                                )}

                                <div className="mb-6 p-3 bg-gray-50 rounded-lg">
                                    <div className="flex justify-between items-center">
                                        <div className="text-sm text-gray-600">
                                            {isSyncing ? (
                                                <span className="flex items-center">
                                                    <div className="animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full mr-2"></div>
                                                    Syncing...
                                                </span>
                                            ) : (
                                                <span className="flex items-center">
                                                    <div className="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                                    {lastSyncTime ? `Synced ${lastSyncTime.toLocaleTimeString()}` : 'Ready to sync'}
                                                </span>
                                            )}
                                        </div>
                                        <button
                                            onClick={forceSync}
                                            disabled={isSyncing}
                                            className="text-blue-600 hover:text-blue-700 text-sm underline disabled:opacity-50"
                                        >
                                            Sync
                                        </button>
                                    </div>
                                </div>

                                {allVocabulary.length === 0 ? (
                                    <div className="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                        <div className="text-yellow-800 font-semibold mb-2">🚀 Get Started!</div>
                                        <div className="text-sm text-yellow-700">
                                            Your vocabulary is empty. Add your first cards using the buttons below!
                                        </div>
                                    </div>
                                ) : dueCards > 0 ? (
                                    <button
                                        onClick={startStudySession}
                                        className="w-full bg-blue-600 text-white py-4 px-6 rounded-xl font-semibold text-lg hover:bg-blue-700 transition-colors mb-4"
                                    >
                                        Study AnkiDroid ({dueCards} cards)
                                    </button>

                        <div className="space-y-3 mb-4">
    <button
        onClick={() => startTypingRecallGame('czech-to-english')}
        className="w-full bg-purple-600 text-white py-4 px-6 rounded-xl font-semibold text-lg hover:bg-purple-700 transition-colors"
    >
        Typing Recall: Czech ➔ English
    </button>
    <button
        onClick={() => startTypingRecallGame('english-to-czech')}
        className="w-full bg-indigo-600 text-white py-4 px-6 rounded-xl font-semibold text-lg hover:bg-indigo-700 transition-colors"
    >
        Typing Recall: English ➔ Czech
    </button>
</div>

                                ) : (
                                    <div className="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                                        <div className="text-green-800 font-semibold mb-2">🎉 All caught up!</div>
                                        <div className="text-sm text-green-700">
                                            No cards are due for review right now. Come back later or add more cards!
                                        </div>
                                    </div>
                                )}

                                {allVocabulary.length > 0 && (
                                    <button
                                        onClick={() => setCurrentScreen('browse')}
                                        className="w-full bg-gray-200 text-gray-700 py-4 px-6 rounded-xl font-semibold text-lg hover:bg-gray-300 transition-colors mb-4"
                                    >
                                        Browse All Cards ({allVocabulary.length})
                                    </button>
                                )}

                                <button
                                    onClick={() => setCurrentScreen('manualAdd')}
                                    className="w-full bg-green-600 text-white py-4 px-6 rounded-xl font-semibold text-lg hover:bg-green-700 transition-colors mb-4"
                                >
                                    Add Card Manually
                                </button>

                                <button
                                    onClick={() => csvInputRef.current?.click()}
                                    className="w-full bg-orange-600 text-white py-4 px-6 rounded-xl font-semibold text-lg hover:bg-orange-700 transition-colors"
                                >
                                    Upload CSV File
                                </button>

                                <input
                                    ref={csvInputRef}
                                    type="file"
                                    accept=".csv"
                                    onChange={handleCsvUpload}
                                    className="hidden"
                                />
                            </div>
                        </div>
                    </div>
                );
            }

            // Manual Add Screen
            if (currentScreen === 'manualAdd') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-600 to-blue-700 p-4">
                        <div className="max-w-md mx-auto">
                            <div className="bg-white rounded-2xl shadow-2xl p-8">
                                <div className="flex items-center mb-6">
                                    <button
                                        onClick={() => setCurrentScreen('home')}
                                        className="mr-4 p-2 text-gray-600 hover:bg-gray-100 rounded-full"
                                    >
                                        ← Back
                                    </button>
                                    <h2 className="text-2xl font-bold text-gray-800">Add New Card</h2>
                                </div>

                                <form onSubmit={handleManualSubmit} className="space-y-6">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Czech Word
                                        </label>
                                        <input
                                            type="text"
                                            value={manualCzech}
                                            onChange={(e) => setManualCzech(e.target.value)}
                                            placeholder="Enter Czech word..."
                                            className="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-lg"
                                            required
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            English Word
                                        </label>
                                        <input
                                            type="text"
                                            value={manualEnglish}
                                            onChange={(e) => setManualEnglish(e.target.value)}
                                            placeholder="Enter English word..."
                                            className="w-full p-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-lg"
                                            required
                                        />
                                    </div>

                                    <div className="flex gap-4">
                                        <button
                                            type="submit"
                                            className="flex-1 bg-green-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-green-700 transition-colors"
                                        >
                                            Add Card
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setCurrentScreen('home')}
                                            className="flex-1 bg-gray-200 text-gray-700 py-3 px-6 rounded-xl font-semibold hover:bg-gray-300 transition-colors"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                );
            }

            // Browse Screen
            if (currentScreen === 'browse') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 p-4">
                        <div className="max-w-md mx-auto">
                            <div className="bg-white rounded-2xl shadow-2xl">
                                <div className="flex items-center p-6 border-b">
                                    <button
                                        onClick={() => setCurrentScreen('home')}
                                        className="mr-4 p-2 text-gray-600 hover:bg-gray-100 rounded-full"
                                    >
                                        ← Back
                                    </button>
                                    <h2 className="text-xl font-semibold">All Vocabulary ({allVocabulary.length} cards)</h2>
                                </div>
                                
                                <div className="max-h-96 overflow-y-auto">
                                    {allVocabulary.map((card, index) => {
                                        const isNew = !card.lastReviewed;
                                        const isDue = card.nextReviewDate && new Date(card.nextReviewDate) <= new Date();
                                        
                                        return (
                                            <div key={index} className="flex justify-between items-center p-4 border-b last:border-b-0 hover:bg-gray-50">
                                                <div className="flex flex-col">
                                                    <span className="font-bold text-lg text-red-600">{card.czech}</span>
                                                    <span className="text-gray-600">{card.english}</span>
                                                    <div className="text-xs text-gray-500 mt-1">
                                                        {isNew ? (
                                                            <span className="text-green-600 font-semibold">NEW</span>
                                                        ) : (
                                                            <span>
                                                                Ease: {((card.easeFactor || 2.5) * 100).toFixed(0)}% • 
                                                                Interval: {card.interval || 1}d • 
                                                                Streak: {card.consecutiveCorrect || 0}
                                                                {isDue && <span className="text-orange-600 font-semibold ml-2">DUE</span>}
                                                            </span>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Study Screen with Easy/Normal/Hard buttons
            if (currentScreen === 'study') {
                if (!currentCard) return <div>Loading...</div>;
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 p-4">
                        <div className="max-w-md mx-auto">
                            <div className="flex items-center justify-between mb-6">
                                <button
                                    onClick={() => setCurrentScreen('home')}
                                    className="p-3 text-white hover:bg-white hover:bg-opacity-20 rounded-full"
                                >
                                    Home
                                </button>
                                <div className="text-white bg-black bg-opacity-20 px-4 py-2 rounded-full font-semibold">
                                    {studyCards.length} cards left
                                </div>
                                <button
                                    onClick={() => {
                                        const dueCards = getCardsForStudy();
                                        setStudyCards(dueCards);
                                        setCurrentCardIndex(0);
                                        setShowAnswer(false);
                                    }}
                                    className="p-3 text-white hover:bg-white hover:bg-opacity-20 rounded-full"
                                >
                                    Reset
                                </button>
                            </div>

                            <div className="bg-white rounded-2xl shadow-2xl p-8 mb-6 min-h-64 flex flex-col justify-center items-center text-center">
                                <div className="text-4xl font-bold text-red-600 mb-6">
                                    {currentCard.czech}
                                </div>
                                
                                {showAnswer && (
                                    <div className="text-2xl text-green-600 border-t-2 border-gray-200 pt-6 mt-6 w-full">
                                        {currentCard.english}
                                    </div>
                                )}
                                
                                {showAnswer && (
                                    <div className="mt-4 text-sm text-gray-500">
                                        {currentCard.lastReviewed ? (
                                            <div>
                                                <div>Current interval: {currentCard.interval || 1} days</div>
                                                <div>Ease factor: {((currentCard.easeFactor || 2.5) * 100).toFixed(0)}%</div>
                                                <div>Consecutive correct: {currentCard.consecutiveCorrect || 0}</div>
                                            </div>
                                        ) : (
                                            <div className="text-blue-600 font-semibold">NEW CARD</div>
                                        )}
                                    </div>
                                )}
                            </div>

                            {!showAnswer ? (
                                <button
                                    onClick={() => setShowAnswer(true)}
                                    className="w-full bg-yellow-500 text-white py-4 px-6 rounded-xl font-bold text-xl hover:bg-yellow-600 transition-colors"
                                >
                                    Show Answer
                                </button>
                            ) : (
                                <div className="space-y-3">
    <button
        onClick={() => handleAnswer(1)}
        className="w-full bg-red-500 text-white py-3 px-6 rounded-xl font-bold text-lg hover:bg-red-600 transition-colors"
    >
        Again ({getNextInterval(currentCard, 1)}d)
    </button>
    <button
        onClick={() => handleAnswer(3)}
        className="w-full bg-orange-500 text-white py-3 px-6 rounded-xl font-bold text-lg hover:bg-orange-600 transition-colors"
    >
        Hard ({getNextInterval(currentCard, 3)}d)
    </button>
    <button
        onClick={() => handleAnswer(4)}
        className="w-full bg-green-500 text-white py-3 px-6 rounded-xl font-bold text-lg hover:bg-green-600 transition-colors"
    >
        Good ({getNextInterval(currentCard, 4)}d)
    </button>
    <button
        onClick={() => handleAnswer(5)}
        className="w-full bg-blue-500 text-white py-3 px-6 rounded-xl font-bold text-lg hover:bg-blue-600 transition-colors"
    >
        Easy ({getNextInterval(currentCard, 5)}d)
    </button>
</div>
                            )}
                        </div>
                    </div>
                );
            }

            if (currentScreen === 'typingRecall') {
    const currentTypingCard = typingGameCards[typingCurrentIndex];

    if (!currentTypingCard) {
        return (
            <div className="min-h-screen bg-gradient-to-br from-green-600 to-blue-700 p-4 flex items-center justify-center">
                <div className="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-md">
                    <h2 className="text-3xl font-bold mb-4">🎉 Game Complete!</h2>
                    <button
                        onClick={() => setCurrentScreen('home')}
                        className="bg-blue-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-blue-700 transition-colors"
                    >
                        Back to Home
                    </button>
                </div>
            </div>
        );
    }

    return (
        <div className="min-h-screen bg-gradient-to-br from-green-600 to-blue-700 p-4 flex items-center justify-center">
            <div className="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-md w-full">
                <div className="text-4xl font-bold text-red-600 mb-6">
                    {typingRecallMode === 'czech-to-english' 
                        ? currentTypingCard.czech 
                        : currentTypingCard.english}
                </div>

                <input
                    type="text"
                    value={userInput}
                    onChange={(e) => setUserInput(e.target.value)}
                    placeholder="Type your answer"
                    className="w-full p-4 mb-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg"
                />

                {!showFeedback && (
                    <button
                        onClick={() => {
                            const correctAnswer = typingRecallMode === 'czech-to-english' 
                                ? currentTypingCard.english.toLowerCase().trim()
                                : currentTypingCard.czech.toLowerCase().trim();
                            const userAnswer = userInput.toLowerCase().trim();
                            setIsCorrect(correctAnswer === userAnswer);
                            setShowFeedback(true);
                        }}
                        className="w-full bg-blue-600 text-white py-3 px-6 rounded-xl font-bold text-lg hover:bg-blue-700 transition-colors"
                    >
                        Check
                    </button>
                )}

                {showFeedback && (
                    <div className="mt-6">
                        {isCorrect ? (
                            <div className="text-green-600 font-bold text-xl mb-4">✅ Correct!</div>
                        ) : (
                            <div className="text-red-600 font-bold text-xl mb-4">
                                ❌ Wrong! Correct: {typingRecallMode === 'czech-to-english' 
                                    ? currentTypingCard.english 
                                    : currentTypingCard.czech}
                            </div>
                        )}

                        <button
                            onClick={() => {
                                setUserInput('');
                                setShowFeedback(false);
                                setTypingCurrentIndex(typingCurrentIndex + 1);
                            }}
                            className="w-full bg-green-600 text-white py-3 px-6 rounded-xl font-bold text-lg hover:bg-green-700 transition-colors"
                        >
                            Next
                        </button>
                    </div>
                )}
            </div>
        </div>
    );
}


            // Results Screen
            if (currentScreen === 'results') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 p-4">
                        <div className="max-w-md mx-auto">
                            <div className="bg-white rounded-2xl shadow-2xl p-8 text-center">
                                <div className="text-6xl mb-6">🎉</div>
                                <h2 className="text-3xl font-bold text-gray-800 mb-8">Session Complete!</h2>
                                
                                <div className="grid grid-cols-2 gap-4 mb-6">
                                    <div className="bg-blue-50 p-4 rounded-xl">
                                        <div className="text-2xl font-bold text-blue-600">{sessionStats.cardsStudied}</div>
                                        <div className="text-sm text-gray-600">Cards Studied</div>
                                    </div>
                                    <div className="bg-green-50 p-4 rounded-xl">
                                        <div className="text-2xl font-bold text-green-600">{sessionStats.newCards}</div>
                                        <div className="text-sm text-gray-600">New Cards</div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-4 gap-2 mb-8">
                                    <div className="bg-red-50 p-3 rounded-lg">
                                        <div className="text-lg font-bold text-red-600">{sessionStats.againCards}</div>
                                        <div className="text-xs text-gray-600">Again</div>
                                    </div>
                                    <div className="bg-orange-50 p-3 rounded-lg">
                                        <div className="text-lg font-bold text-orange-600">{sessionStats.hardCards}</div>
                                        <div className="text-xs text-gray-600">Hard</div>
                                    </div>
                                    <div className="bg-green-50 p-3 rounded-lg">
                                        <div className="text-lg font-bold text-green-600">{sessionStats.normalCards}</div>
                                        <div className="text-xs text-gray-600">Good</div>
                                    </div>
                                    <div className="bg-blue-50 p-3 rounded-lg">
                                        <div className="text-lg font-bold text-blue-600">{sessionStats.easyCards}</div>
                                        <div className="text-xs text-gray-600">Easy</div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <button
                                        onClick={startStudySession}
                                        className="bg-blue-600 text-white py-4 px-4 rounded-xl font-semibold hover:bg-blue-700 transition-colors"
                                    >
                                        Study More
                                    </button>
                                    <button
                                        onClick={() => setCurrentScreen('home')}
                                        className="bg-gray-200 text-gray-700 py-4 px-4 rounded-xl font-semibold hover:bg-gray-300 transition-colors"
                                    >
                                        Back Home
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // CSV Processing Screen
            if (currentScreen === 'csvProcessing') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-orange-600 to-red-700 p-4">
                        <div className="max-w-md mx-auto">
                            <div className="bg-white rounded-2xl shadow-2xl p-8 text-center">
                                <div className="text-6xl mb-6">📄</div>
                                <h2 className="text-2xl font-bold text-gray-800 mb-4">Processing CSV</h2>
                                
                                {isProcessingCsv ? (
                                    <div>
                                        <div className="animate-spin rounded-full h-16 w-16 border-4 border-orange-500 border-t-transparent mx-auto mb-4"></div>
                                        <p className="text-gray-600">Reading your CSV file...</p>
                                        <p className="text-sm text-gray-500 mt-2">Supports up to 300 cards</p>
                                    </div>
                                ) : (
                                    <div>
                                        <div className="text-4xl mb-4">✅</div>
                                        <p className="text-gray-600 mb-6">Processing complete!</p>
                                        
                                        {csvCards.length > 0 ? (
                                            <div>
                                                <p className="text-green-600 font-semibold mb-2">
                                                    Found {csvCards.length} vocabulary pairs
                                                </p>
                                                {csvValidationResults.length > 0 && (
                                                    <div className="mb-4">
                                                        <p className="text-sm text-gray-600">
                                                            ✅ Valid: {csvValidationResults.filter(v => v.isValid).length} | 
                                                            ⚠️ Needs review: {csvValidationResults.filter(v => !v.isValid).length}
                                                        </p>
                                                    </div>
                                                )}
                                                <button
                                                    onClick={() => setCurrentScreen('editCsvCards')}
                                                    className="w-full bg-green-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-green-700 transition-colors mb-3"
                                                >
                                                    Review & Edit Cards
                                                </button>
                                            </div>
                                        ) : (
                                            <div>
                                                <p className="text-red-600 mb-4">No vocabulary pairs found in CSV.</p>
                                                <div className="text-sm text-gray-600 mb-4 p-3 bg-gray-50 rounded">
                                                    Expected format:<br/>
                                                    <code>czech_word,english_word<br/>
                                                    dobrý den,good day<br/>
                                                    děkuji,thank you</code>
                                                </div>
                                            </div>
                                        )}
                                        
                                        <button
                                            onClick={() => setCurrentScreen('home')}
                                            className="w-full bg-gray-200 text-gray-700 py-3 px-6 rounded-xl font-semibold hover:bg-gray-300 transition-colors"
                                        >
                                            Back to Home
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // Edit CSV Cards Screen
            if (currentScreen === 'editCsvCards') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-orange-600 to-red-700 p-4">
                        <div className="max-w-md mx-auto">
                            <div className="bg-white rounded-2xl shadow-2xl">
                                <div className="flex items-center justify-between p-6 border-b">
                                    <button
                                        onClick={() => setCurrentScreen('home')}
                                        className="mr-4 p-2 text-gray-600 hover:bg-gray-100 rounded-full"
                                    >
                                        ← Back
                                    </button>
                                    <h2 className="text-xl font-semibold">Review CSV Cards ({csvCards.length})</h2>
                                    <div></div>
                                </div>
                                
                                <div className="p-6">
                                    <div className="max-h-96 overflow-y-auto mb-6">
                                        {csvCards.map((card, index) => {
                                            const validation = csvValidationResults[index];
                                            const isValid = !validation || validation.isValid || card.manuallyApproved;
                                            
                                            return (
                                                <div key={index} className={`p-4 rounded-lg mb-4 border-2 ${
                                                    isValid ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'
                                                }`}>
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div className="flex items-center">
                                                            <span className="text-sm text-gray-500 mr-2">Card {index + 1}</span>
                                                            {isValid ? (
                                                                <span className="text-green-600 text-sm">✅ Valid</span>
                                                            ) : (
                                                                <span className="text-yellow-600 text-sm">⚠️ Needs review</span>
                                                            )}
                                                        </div>
                                                        <div className="flex gap-2">
                                                            {!isValid && (
                                                                <button
                                                                    onClick={() => approveCsvCard(index)}
                                                                    className="text-green-600 hover:text-green-700 text-sm px-2 py-1 bg-green-100 rounded"
                                                                >
                                                                    Approve
                                                                </button>
                                                            )}
                                                            <button
                                                                onClick={() => removeCsvCard(index)}
                                                                className="text-red-500 hover:text-red-700 text-sm px-2 py-1 bg-red-100 rounded"
                                                            >
                                                                Remove
                                                            </button>
                                                        </div>
                                                    </div>
                                                    
                                                    {validation && !validation.isValid && !card.manuallyApproved && (
                                                        <div className="mb-3 p-2 bg-yellow-100 rounded text-sm">
                                                            <strong>Issues detected:</strong>
                                                            <ul className="list-disc list-inside text-yellow-700">
                                                                {validation.issues.map((issue, i) => (
                                                                    <li key={i}>{issue}</li>
                                                                ))}
                                                            </ul>
                                                        </div>
                                                    )}
                                                    
                                                    <div className="space-y-3">
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                                Czech {!validation?.czechValid && !card.manuallyApproved && (
                                                                    <span className="text-red-500">⚠️</span>
                                                                )}
                                                            </label>
                                                            <input
                                                                type="text"
                                                                value={card.czech}
                                                                onChange={(e) => editCsvCard(index, 'czech', e.target.value)}
                                                                className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                                                            />
                                                        </div>
                                                        
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                                English {!validation?.englishValid && !card.manuallyApproved && (
                                                                    <span className="text-red-500">⚠️</span>
                                                                )}
                                                            </label>
                                                            <input
                                                                type="text"
                                                                value={card.english}
                                                                onChange={(e) => editCsvCard(index, 'english', e.target.value)}
                                                                className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                                                            />
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                    
                                    {csvCards.length > 0 && (
                                        <div className="mb-4 p-3 bg-orange-50 rounded-lg">
                                            <div className="text-sm text-orange-700">
                                                <strong>Summary:</strong> {csvCards.filter((_, i) => !csvValidationResults[i] || csvValidationResults[i].isValid || csvCards[i].manuallyApproved).length} cards ready to add
                                            </div>
                                        </div>
                                    )}
                                    
                                    {csvCards.length > 0 && (
                                        <button
                                            onClick={addCsvCardsToVocabulary}
                                            className="w-full bg-orange-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-orange-700 transition-colors mb-3"
                                        >
                                            Add Valid Cards to Vocabulary
                                        </button>
                                    )}
                                    
                                    <button
                                        onClick={() => setCurrentScreen('home')}
                                        className="w-full bg-gray-200 text-gray-700 py-3 px-6 rounded-xl font-semibold hover:bg-gray-300 transition-colors"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        };

        ReactDOM.render(<CzechFlashcardApp />, document.getElementById('root'));
    </script>
</body>
</html>
